#!/bin/sh

case $(uname -m) in
    ppc64)
        grep OPAL  /proc/cpuinfo >/dev/null 2>&1 && opal=1

        if [ "$opal" ]; then
            modprobe -b kvm >/dev/null 2>&1 && kvm=1
        fi
        ;;
    s390x)
        modprobe -b kvm >/dev/null 2>&1 && kvm=1
        ;;
esac

if [ "$kvm" ]; then
    # no reason why vhost should not work with TCG, but currently it does not
    modprobe -b vhost-net >/dev/null 2>&1
else
    exit 0
fi
