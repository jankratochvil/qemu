From 3996c89759a08601e619f14718562d38871200c9 Mon Sep 17 00:00:00 2001
From: Michal Novotny <minovotn@redhat.com>
Date: Fri, 13 Jan 2012 11:15:17 +0100
Subject: [PATCH 1/2] Revert "virtio-blk: refuse SG_IO requests with scsi=off"

This reverts commit f328348a0d839d060604cd1189dfdbf0caafcc57.

Signed-off-by: Michal Novotny <minovotn@redhat.com>
---
 hw/virtio-blk.c |    8 --------
 1 files changed, 0 insertions(+), 8 deletions(-)

diff --git a/hw/virtio-blk.c b/hw/virtio-blk.c
index 1b3e29a..0e56611 100644
--- a/hw/virtio-blk.c
+++ b/hw/virtio-blk.c
@@ -28,7 +28,6 @@ typedef struct VirtIOBlock
     BlockConf *conf;
     unsigned short sector_mask;
     char sn[BLOCK_SERIAL_STRLEN];
-    uint32_t host_features;
     DeviceState *qdev;
 } VirtIOBlock;
 
@@ -150,12 +149,6 @@ static void virtio_blk_handle_scsi(VirtIOBlockReq *req)
     int status;
     int i;
 
-    if ((req->dev->host_features & VIRTIO_BLK_F_SCSI) == 0) {
-        virtio_blk_req_complete(req, VIRTIO_BLK_S_UNSUPP);
-        qemu_free(req);
-        return;
-    }
-
     /*
      * We require at least one output segment each for the virtio_blk_outhdr
      * and the SCSI command block.
@@ -505,7 +498,6 @@ static uint32_t virtio_blk_get_features(VirtIODevice *vdev, uint32_t features)
     if (bdrv_is_read_only(s->bs))
         features |= 1 << VIRTIO_BLK_F_RO;
 
-    s->host_features = features;
     return features;
 }
 
-- 
1.7.7.4

