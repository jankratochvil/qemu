From 32f073b3378a100487f06ece63a037c8dddfe8db Mon Sep 17 00:00:00 2001
From: Eduardo Habkost <ehabkost@redhat.com>
Date: Tue, 19 Jul 2011 10:07:34 -0300
Subject: [RHEL6 qemu-kvm PATCH] Revert "CVE-2011-2527: os-posix: set groups properly for -runas"

RH-Reverts: ddf94a2b7b1563a7a4a56734d21e23036b789da1
RH-Reverts-patchwork-id: 29962
Bugzilla-related: 722582
Signed-off-by: Eduardo Habkost <ehabkost@redhat.com>
---
 vl.c |    6 ------
 1 files changed, 0 insertions(+), 6 deletions(-)

diff --git a/vl.c b/vl.c
index 7ebb5a7..4e800b2 100644
--- a/vl.c
+++ b/vl.c
@@ -27,7 +27,6 @@
 #include <time.h>
 #include <errno.h>
 #include <sys/time.h>
-#include <grp.h>
 #include <zlib.h>
 
 /* Needed early for CONFIG_BSD etc. */
@@ -6824,11 +6823,6 @@ int main(int argc, char **argv, char **envp)
             fprintf(stderr, "Failed to setgid(%d)\n", pwd->pw_gid);
             exit(1);
         }
-        if (initgroups(pwd->pw_name, pwd->pw_gid) < 0) {
-            fprintf(stderr, "Failed to initgroups(\"%s\", %d)\n",
-                    pwd->pw_name, pwd->pw_gid);
-            exit(1);
-        }
         if (setuid(pwd->pw_uid) < 0) {
             fprintf(stderr, "Failed to setuid(%d)\n", pwd->pw_uid);
             exit(1);
-- 
1.7.3.2

